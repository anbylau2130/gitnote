--海信 接口数据
--select b.FSOURCEBILLNO as 海信单号,sum(b.FQTY) as 数量,count(a.FSOURCEBILLNO) as 分录行数 from tSfHxnPurRtnOrd_IoHis a
--left join tSfHxnPurRtnOrdPlu_IoHis b on a.FSOURCEBILLNO=b.FSOURCEBILLNO
--where to_date(a.FDATE,'YYYY-MM-DD')>=to_date('2018-09-28','YYYY-MM-DD')
--group by b.FSOURCEBILLNO ;




IF object_id('tempdb..#temp') is not null Begin
    drop table #temp
End

CREATE TABLE #temp(
海信单号 VARCHAR(max),
数量 DECIMAL(18,2),
分录行数 INT 
)

insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092800001', 22, 2);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092800016', 38, 3);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092800048', 57, 3);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092800004', 279.5, 26);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092800013', 5, 2);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092800027', 56, 2);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092800031', 1, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092900042', 36, 3);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092900002', 330, 22);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18093000014', 158, 26);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18093000031', 1, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18093000048', 1, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18093000044', 1, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100100015', 18, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18093000004', 30, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092900043', 34, 2);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092900034', 26, 5);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18093000043', 86, 2);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100100002', 126, 7);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100100018', 42, 2);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092900045', 20, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092900008', 44, 3);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18093000016', 114, 22);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18093000030', 2, 2);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092900019', 5, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18093000032', 334, 20);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100100034', 871, 43);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18093000005', 48, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100100038', 851, 32);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100100023', 72, 7);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100200023', 495, 28);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100200024', 645, 30);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100200040', 505, 18);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100200030', 377, 19);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100500006', 2, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100600009', 7, 4);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100200057', 446, 28);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100300016', 144, 10);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100400012', 8, 2);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100700016', 1, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100800009', 220, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100300001', 4, 3);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18101100014', 42, 2);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18101300003', 14, 3);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18101200016', 102, 8);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18101000017', 24, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18101400002', 47, 3);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18101100016', 9, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18101400003', 86, 4);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18101200022', 189, 13);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092800019', 100, 2);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092800051', 40, 2);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092800054', 200, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092900001', 457, 19);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092800021', 14, 10);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092800022', 319, 30);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092800035', 2, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092800036', 3, 2);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092800037', 97, 13);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092800042', 19.5, 4);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18093000018', 167, 6);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18093000019', 199, 17);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092900040', 427, 20);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18093000050', 680, 27);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100100009', 11, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092900016', 32, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18093000021', 24, 4);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100100016', 14, 4);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18093000002', 1, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18093000036', 201, 20);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100100026', 883, 32);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100100021', 21, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100100039', 77, 11);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100100033', 412, 16);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100100007', 159, 16);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100200005', 61, 3);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100200010', 237, 9);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100100048', 876, 32);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100200007', 336, 25);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100100045', 401, 23);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100200022', 485, 21);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100100049', 241, 12);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100200006', 260, 9);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100200021', 211, 10);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100200033', 566, 33);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100200036', 365, 16);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100200028', 518, 30);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100200034', 728, 33);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100200039', 210, 31);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100200032', 582, 27);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100800008', 10, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100300003', 81, 8);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100400008', 2, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100300013', 314, 31);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100600008', 76, 4);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100800002', 22, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100500008', 21, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100800010', 54, 4);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100900015', 394, 16);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18101100011', 42, 3);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18101200012', 3, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18101100010', 3, 2);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18101100012', 409, 9);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18101200006', 20, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18101200014', 40, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18101200023', 5, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18101400011', 50, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18101200018', 10, 8);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092800053', 414, 7);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092800018', 62, 2);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092800026', 39, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092800033', 8, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092800045', 7, 2);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092800046', 22, 2);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092900037', 419, 16);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18093000045', 100, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18093000052', 50, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18093000053', 61, 7);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100100005', 426, 32);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100100013', 440, 32);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092900017', 20, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18093000027', 170, 8);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18093000058', 4, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092900023', 792, 2);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18093000051', 329, 7);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092900003', 6, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18093000035', 160, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100100028', 1134, 23);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100100024', 354, 21);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100100008', 988, 26);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100200013', 299, 12);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100200004', 469, 20);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100200008', 287, 12);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100200016', 104, 10);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100200026', 467, 27);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100200046', 379, 31);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100200025', 868, 31);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100200041', 1030, 35);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100100030', 119, 6);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100200029', 709, 32);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100300008', 24, 2);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100400002', 803, 43);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100600003', 11, 3);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100700013', 321, 8);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100800003', 24, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100300009', 54, 3);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100800001', 91, 13);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100800004', 10, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100900018', 50, 4);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18101000004', 99, 9);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18101000005', 169, 9);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100900008', 44, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18101000006', 20, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100400001', 280, 16);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100400003', 115, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100700003', 110, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100900006', 53, 10);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100900010', 4, 2);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100900011', 6, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100200062', 11, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18101100008', 12, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18101100017', 206, 7);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18101100003', 14, 2);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18101400005', 24, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18101100024', 286, 3);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18101400004', 162, 3);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18101200020', 39, 3);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18101200019', 3, 2);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18101400001', 5, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092800023', 36, 3);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092800056', 2178, 25);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092800030', 65.5, 8);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092800032', 365, 23);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092800007', 10, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092800041', 10, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092900014', 85, 16);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092900020', 56, 8);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092900024', 6, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092900026', 28, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092900038', 110, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092900018', 2, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092900046', 12, 4);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18093000017', 3, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092900011', 3, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18093000022', 3, 2);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100100006', 144, 9);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100100012', 8, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100100001', 11, 2);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18093000006', 141, 21);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18093000059', 4, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092900028', 1, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18093000037', 10, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092900044', 15, 6);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18093000012', 178, 24);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100100051', 986, 31);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100200014', 742, 32);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100200020', 31, 3);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100200043', 446, 30);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100200048', 173, 26);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100200050', 30, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100200051', 32, 4);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100300011', 12, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100400007', 12, 4);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100400009', 163, 8);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100700001', 1, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18101000002', 5, 2);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100700007', 49, 2);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100900012', 52, 2);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100300007', 28, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100300015', 100, 6);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100600004', 5, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100700015', 124, 2);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100900003', 6, 3);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100200056', 205, 14);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100200059', 328, 12);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18101100020', 258, 21);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18101200009', 132, 2);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18101100018', 10, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18101100025', 1, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18101100006', 116, 3);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18101100019', 22, 2);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18101200003', 14, 2);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18101200007', 9, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18101200008', 20, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18101400008', 335, 4);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18101400009', 295, 9);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18101400010', 32, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18101200017', 13, 3);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18101400007', 41, 6);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092800043', 4, 2);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092800049', 36, 4);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092800012', 150, 10);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092800003', 51, 12);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092800006', 27, 7);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092800028', 80, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092900035', 1, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092900029', 24, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18093000025', 8, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100100010', 250, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092900025', 80, 9);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100100031', 229, 17);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100100029', 22, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100100025', 413, 22);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100100035', 22, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100100020', 67, 11);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18093000009', 146, 25);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18093000020', 141, 21);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100100037', 30, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100200009', 280, 16);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100100032', 275, 15);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100200052', 581, 31);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100500002', 105, 4);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100600002', 134, 10);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100800011', 2, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100900004', 54, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100900017', 24, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18101000001', 12, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18101000003', 100, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100200058', 327, 11);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18101000011', 730, 2);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18101000016', 131.5, 14);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100300010', 1, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100500004', 34, 3);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100700018', 20, 2);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100800005', 3, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18101100015', 9, 3);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18101100005', 438, 11);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18101100009', 33, 6);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18101100028', 3, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18101000018', 117, 10);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18101100023', 28, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18101200011', 58, 2);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18101200010', 42, 2);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092800038', 10, 4);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092800020', 42, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092800011', 1498, 19);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092800005', 83, 3);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092800010', 4, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092800029', 3, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092800040', 39, 2);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092900030', 25, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092900004', 247, 12);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18093000041', 398, 11);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092900006', 61, 5);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18093000049', 5, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100100011', 43.5, 2);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100100017', 810, 33);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092900022', 6, 2);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100100014', 741, 31);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100100019', 378, 26);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092900007', 20, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092900010', 237, 5);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18093000010', 10, 4);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18093000033', 17, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100100042', 648, 26);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18093000007', 19, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18093000013', 123, 23);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18093000047', 100, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092900033', 2, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100200002', 667, 32);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100200012', 70, 5);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100100044', 595, 24);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100200019', 424, 31);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100200049', 225, 13);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100200044', 12, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100200053', 177, 7);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100200031', 180, 9);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100200063', 657, 24);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100700005', 94, 2);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100700008', 129, 3);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100800006', 1, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100900016', 258, 28);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100500001', 14, 2);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100700009', 2, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100900014', 1, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18101000007', 2, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100200035', 806, 31);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100300014', 2, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100500009', 20, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100700012', 38, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100700017', 69, 3);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100900002', 56, 3);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100400006', 2, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100500007', 265, 26);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100900007', 30, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100200060', 758, 31);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18101100007', 4, 2);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18101200013', 216, 2);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18101100013', 24, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18101200002', 18, 2);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18101200004', 122, 3);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18101200025', 12, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18101400012', 16, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092800014', 2, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092800024', 102, 3);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092800050', 8, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092800052', 5, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092800009', 11, 4);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092800002', 50, 3);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092900027', 14, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092900036', 347, 21);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092900039', 20, 2);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092900031', 10, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100100004', 86, 5);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18093000001', 2464, 25);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18093000003', 4, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18093000055', 30, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18093000040', 4, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18093000042', 92, 17);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18093000057', 210, 9);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092900009', 2.3, 3);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092900021', 18, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18093000034', 18, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100100040', 445, 33);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18093000026', 71.1, 13);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100200001', 133, 21);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100200017', 653, 34);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100100047', 560, 30);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100100043', 660, 31);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100200018', 770, 33);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100200011', 69, 11);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100200015', 575, 21);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100100046', 615, 25);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100100050', 281, 18);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100200045', 12, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100200042', 778, 36);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100200037', 824, 31);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100200027', 164, 28);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100300006', 318, 29);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100300012', 271, 31);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100500003', 9, 3);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100600001', 11, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100700004', 36, 3);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100900013', 20, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100700006', 2, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18101000008', 40, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18101000009', 10, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18101000013', 9, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100200054', 84, 5);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100400004', 10, 4);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100600007', 1, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100700010', 1, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100700011', 1, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100700020', 12, 2);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100400005', 29, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100700019', 62, 2);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100200055', 104, 19);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18101300001', 354, 4);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18101100002', 42, 9);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18101100027', 5, 5);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18101200005', 1, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18101100021', 1, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18101400013', 12.5, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18101200024', 2855, 15);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18101500001', 8, 2);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18101400006', 1, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18101500003', 5, 3);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18101300002', 420, 13);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092800047', 8, 5);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092800055', 50, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092800025', 159, 5);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092800015', 10, 5);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092800008', 18, 2);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092800017', 15, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092800034', 6, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092800039', 3, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092800044', 28, 17);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092900015', 8, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092900005', 13, 3);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18093000015', 14, 2);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092900012', 26, 2);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18093000029', 57, 8);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18093000054', 338, 11);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100100003', 70, 3);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18093000038', 36, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18093000039', 3, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18093000056', 6, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092900041', 217, 26);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18093000023', 24, 2);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092900013', 3, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18093000028', 6, 2);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100100027', 172, 22);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100100041', 929, 35);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18093000008', 340, 20);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100100036', 218, 22);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18093000046', 100, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18092900032', 1, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100100022', 748, 33);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100200003', 57, 12);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100100052', 50, 2);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100200047', 153, 5);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100200038', 916, 34);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100300004', 742, 32);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100300005', 36, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100400013', 2, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100900001', 49, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100900009', 20, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100300002', 2, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100500005', 14, 2);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100600005', 8, 2);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18101000010', 18, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18101000012', 65, 4);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18101000014', 28, 2);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18101000015', 4, 3);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100400011', 12, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100600006', 8, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100700014', 10, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100900005', 338, 22);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100400010', 3, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18100700002', 4, 4);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18101100022', 24, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18101100001', 44, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18101100026', 30, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18101100004', 1, 1);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18101200001', 6, 3);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18101200015', 2, 2);
insert into #temp (海信单号, 数量, 分录行数) values ('20PTSQ18101500002', 10, 1);


--统计
SELECT a.海信单号,a.数量,b.FBILLNO,b.QTY,a.数量-b.QTY AS 差异 FROM #temp a
LEFT   JOIN (
	

	SELECT stk.FBILLNO,stk.FORIGINNUMBER AS 原始单号, SUM(stkEntry.FQTY) QTY FROM T_STK_STKTRANSFERIN stk
	LEFT JOIN dbo.T_STK_STKTRANSFERINENTRY stkEntry ON stkEntry.FID = stk.FID
	LEFT JOIN dbo.T_SEC_USER u ON stk.FAPPROVERID=u.FUSERID
	--WHERE u.FNAME='Administrator'
	GROUP BY stk.FBILLNO,stk.FORIGINNUMBER

) b ON a.海信单号=b.原始单号

WHERE a.数量-b.QTY<>0